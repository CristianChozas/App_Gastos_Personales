{% extends "base.html" %}
{% block titulo %}Mis gastos{% endblock %}

{% block header %}
    <h1>Mis gastos</h1>
{% endblock %}

{% block contenido %}
    <form method="get" class="filtros" id="form-filtros">
        <label>Desde 
            <input type="date" name="desde" value="{{ request.args.get('desde','') }}">
        </label>
        <label>Hasta 
            <input type="date" name="hasta" value="{{ request.args.get('hasta','') }}">
        </label>
        <label>Mín 
            <input type="text" name="cantidad_min" value="{{ request.args.get('cantidad_min','') }}" placeholder="0.00">
        </label>
        <label>Máx 
            <input type="text" name="cantidad_max" value="{{ request.args.get('cantidad_max','') }}" placeholder="999.99">
        </label>
        <button type="submit">Filtrar</button>
        <button type="button" id="btn-limpiar">Limpiar</button>
    </form>


    <section class="total">
        <strong>Total:</strong> {{ '%.2f'|format(total or 0) }}
    </section>

    {% if gastos %}
        <table class="tabla-gastos">
        <thead>
            <tr>
            <th>Fecha</th>
            <th>Categoría</th>
            <th>Descripción</th>
            <th style="text-align:right;">Cantidad</th>
            <th></th>
            </tr>
        </thead>
        <tbody>
            {% for g in gastos %}
            <tr>
            <td>{{ g.fecha }}</td>
            <td>{{ g.categoria }}</td>
            <td>{{ g.descripcion or '' }}</td>
            <td style="text-align:right;">{{ '%.2f'|format(g.cantidad) }}</td>
            <td>
                <form method="post" action="{{ url_for('borrar_gasto', gasto_id=g.id) }}" onsubmit="return confirm('¿Eliminar este gasto?');">
                <button type="submit">Borrar</button>
                </form>
            </td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
    {% else %}
        <p>No hay gastos para los filtros actuales.</p>
    {% endif %}

    <p><a class="btn" href="{{ url_for('nuevo_gasto') }}"> Nuevo gasto</a></p>
{% endblock %}
{% block extra %}
    <script>
        const form = document.getElementById('form-filtros');
        const limpiarBtn = document.getElementById('btn-limpiar');

        limpiarBtn.addEventListener('click', () => {
            // Vaciar todos los campos del formulario
            form.querySelectorAll('input').forEach(input => input.value = '');
            // Enviar la solicitud sin filtros
            form.submit();
        });
    </script>
{% endblock %}
